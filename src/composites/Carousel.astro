---
// @composites/Carousel.astro
import { _getGallery } from '@scripts/data/get-gallery'

interface Props extends HTMLAttributes {
	tag?: keyof HTMLElementTagNameMap
	year: string
	limit?: number
}

const {
	tag: Carousel = 'section',
	year,
	limit = 50,
	class: classes,
	...attrs
} = Astro.props as Props

const gallery = await _getGallery(year, limit)
const IMG_WIDTH = 1600
const imgSrc = (url: string) =>
	import.meta.env.DEV
		? url
		: `/.netlify/images?url=${encodeURIComponent(url)}&w=${IMG_WIDTH}&q=80&auto=format`
---

<Carousel
	data-pbl-carousel
	data-pbl-reveal-zoom
	{...attrs}
	class:list={[
		'w-full',
		'bg-black',
		'py-[calc(var(--space)*4)] lg:py-[calc(var(--space)*3)]',
		classes,
	]}>
	<ul
		data-pbl-carousel-track
		class:list={[
			'flex items-center gap-[calc(var(--space)/2)]',
			'overflow-x-auto',
			'snap-x snap-mandatory select-none touch-pan-x touch-pan-y touch-pinch-zoom',
			'[scrollbar-width:none] [&::-webkit-scrollbar]:hidden [-webkit-overflow-scrolling:touch]',
		]}>
		{
			gallery.map((item) => (
				<li
					data-pbl-carousel-slide
					data-pbl-tap-zoom
					class:list={['shrink-0 snap-center']}>
					<img
						src={imgSrc(item.image)}
						alt={item.altText ?? item.title}
						tabindex='0'
						role='button'
						class:list={[
							'block',
							'w-full object-contain',
							'h-auto max-h-96 md:max-h-128 lg:max-h-160',
						]}
					/>
				</li>
			))
		}
	</ul>
</Carousel>
